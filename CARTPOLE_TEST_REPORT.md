# CartPole æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2025-11-26 13:03:26  
**ç¯å¢ƒ**: cartpole_llama  
**æ¨¡å‹**: llama3.1  

---

## æµ‹è¯•ç»“æœæ€»ç»“

### ğŸ¯ æ ¸å¿ƒç»“æœ
- **Pole çŠ¶æ€**: âŒ **å€’ä¸‹äº†**
- **åšæŒæ­¥æ•°**: 18 æ­¥
- **æœ€ç»ˆå¾—åˆ†**: 18.0
- **åŠ¨ä½œåºåˆ—**: `[0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1]`

### ğŸ“Š çŠ¶æ€æ¼”å˜è¿‡ç¨‹

#### åˆå§‹çŠ¶æ€ (Step 0)
```
Cart Position: CENTER
Pole Angle: VERTICAL (perfect!)
Cart Velocity: stationary
Pole Angular Velocity: stable
```

#### å€’ä¸‹å‰çŠ¶æ€ (Step 17)
```
Cart Position: SLIGHTLY RIGHT (x_bin=4)
Pole Angle: LEFT (theta_bin=1)
Cart Velocity: moving right
Pole Angular Velocity: tilting left
```

#### æœ€ç»ˆçŠ¶æ€ (Step 18) - **å€’ä¸‹**
```
Cart Position: SLIGHTLY RIGHT (x_bin=4)
Pole Angle: FAR LEFT (falling!) âš ï¸ (theta_bin=0)
Cart Velocity: moving right
Pole Angular Velocity: tilting left
```

---

## è¯¦ç»†çŠ¶æ€è½¨è¿¹

| Step | x_bin | theta_bin | x_dot | theta_dot | Action | Description |
|------|-------|-----------|-------|-----------|--------|-------------|
| 0 | 3 | 3 | 0 | 0 | 0 (Left) | åˆå§‹ï¼šä¸­å¿ƒï¼Œå‚ç›´ |
| 1 | 3 | 3 | -1 | 1 | 1 (Right) | å¼€å§‹å‘å·¦ç§»ï¼Œpoleå‘å³å€¾ |
| 2 | 3 | 4 | 0 | 0 | 1 (Right) | poleå‘å³å€¾æ–œ |
| 3 | 3 | 4 | 1 | -1 | 1 (Right) | poleå¼€å§‹å‘å·¦å›æ‘† |
| 4 | 3 | 3 | 1 | -1 | 1 (Right) | poleå›åˆ°å‚ç›´ |
| 5 | 3 | 3 | 1 | -1 | 1 (Right) | **é¦–æ¬¡æ£€ç´¢åˆ°ç»éªŒ** |
| 6 | 4 | 3 | 1 | -1 | 0 (Left) | cartç§»åˆ°å³ä¾§ |
| 7 | 4 | 2 | 1 | -1 | 0 (Left) | poleå‘å·¦å€¾ |
| 8-9 | 4 | 2 | 1 | -1 | 0 (Left) | **å¾ªç¯æ£€ç´¢ç»éªŒ** |
| 10 | 4 | 2 | 0 | -1 | 1 (Right) | carté€Ÿåº¦å½’é›¶ |
| 11 | 4 | 2 | 1 | -1 | 0 (Left) | **æ£€ç´¢åˆ°3æ¡ç»éªŒ** |
| 12 | 4 | 1 | 0 | -1 | 1 (Right) | poleå±é™©å€¾æ–œ |
| 13-17 | 4 | 1 | 1 | -1 | 1 (Right) | **æŒç»­æ£€ç´¢ç»éªŒï¼Œå°è¯•å¹³è¡¡** |
| **18** | **4** | **0** | **1** | **-1** | **1** | **ğŸ’¥ Poleå€’ä¸‹ï¼** |

---

## ç»éªŒå­¦ä¹ ç³»ç»Ÿè¡¨ç°

### âœ… æ­£å¸¸å·¥ä½œçš„éƒ¨åˆ†
1. **ç»éªŒä¿å­˜**: æˆåŠŸä¿å­˜äº†18ä¸ªçŠ¶æ€-åŠ¨ä½œ-ä¸‹ä¸€çŠ¶æ€çš„ç»éªŒ
2. **ç»éªŒæ£€ç´¢**: 
   - Step 5: æ£€ç´¢åˆ°1æ¡ç»éªŒ
   - Step 8: æ£€ç´¢åˆ°1æ¡ç»éªŒ
   - Step 9: æ£€ç´¢åˆ°2æ¡ç»éªŒ
   - Step 11: æ£€ç´¢åˆ°3æ¡ç»éªŒ
   - Step 14-17: æ¯æ­¥æ£€ç´¢åˆ°1-4æ¡ç»éªŒ
3. **çŠ¶æ€ç¦»æ•£åŒ–**: è¿ç»­çŠ¶æ€æˆåŠŸè½¬æ¢ä¸ºç¦»æ•£bins

### ğŸ” è§‚å¯Ÿåˆ°çš„é—®é¢˜

#### 1. **é‡å¤åŠ¨ä½œå¾ªç¯** (Steps 8-9, 13-17)
- **ç°è±¡**: åœ¨ç›¸åŒçŠ¶æ€ä¸‹é‡å¤æ‰§è¡Œç›¸åŒåŠ¨ä½œ
  - Steps 8-9: çŠ¶æ€ `(4,2,1,-1)` é‡å¤æ‰§è¡ŒåŠ¨ä½œ 0
  - Steps 13-17: çŠ¶æ€ `(4,1,1,-1)` é‡å¤æ‰§è¡ŒåŠ¨ä½œ 1 (5æ¬¡ï¼)
  
- **åŸå› åˆ†æ**:
  - LLMæ£€ç´¢åˆ°äº†å†å²ç»éªŒï¼Œä½†è¯¥ç»éªŒæ˜¾ç¤º"ç›¸åŒçŠ¶æ€â†’ç›¸åŒåŠ¨ä½œâ†’ç›¸åŒçŠ¶æ€"
  - Promptæ²¡æœ‰æ˜ç¡®æŒ‡ç¤ºé¿å…"åŸåœ°è¸æ­¥"çš„ç»éªŒ
  - LLMæ²¡æœ‰æ„è¯†åˆ°è¿™æ˜¯ä¸€ä¸ªæ— æ•ˆå¾ªç¯

#### 2. **ç¼ºå°‘"å¤±è´¥"æ ‡è®°**
- å½“å‰ç»éªŒä¸­æ²¡æœ‰æ ‡è®°å“ªäº›çŠ¶æ€/åŠ¨ä½œä¼šå¯¼è‡´poleå€’ä¸‹
- æœ€åä¸€æ¡ç»éªŒ (Step 18): `theta_bin=1 â†’ action 1 â†’ theta_bin=0` åº”è¯¥è¢«æ ‡è®°ä¸ºå¤±è´¥

#### 3. **Promptå·¥ç¨‹ä¸è¶³**
- å½“å‰promptæ²¡æœ‰å¼ºè°ƒ"é¿å…å¯¼è‡´poleå€’ä¸‹çš„åŠ¨ä½œ"
- ç¼ºå°‘å¯¹"è¾¹ç•ŒçŠ¶æ€"ï¼ˆtheta_bin=0æˆ–6ï¼‰çš„ç‰¹æ®Šè­¦å‘Š

---

## æ”¹è¿›å»ºè®®

### ğŸ”§ çŸ­æœŸæ”¹è¿› (Promptä¼˜åŒ–)

#### 1. åœ¨ç»éªŒä¸­æ ‡è®°å¤±è´¥
```python
# åœ¨ CartPoleLlamaAdaptor.get_action_prompt() ä¸­
if next_theta_bin <= 0 or next_theta_bin >= len(self.theta_bins):
    is_failure = True
    user_prompt += f"  Action {action} â†’ Result: âš ï¸ FAILED (pole fell!)\n"
```

#### 2. å¼ºåŒ–å±é™©çŠ¶æ€è­¦å‘Š
```python
# å½“å‰çŠ¶æ€æ¥è¿‘è¾¹ç•Œæ—¶
if state['theta_bin'] in [0, 1, 5, 6]:
    user_prompt += "\nâš ï¸ CRITICAL: Pole is near falling! Choose action carefully!\n"
```

#### 3. é¿å…å¾ªç¯åŠ¨ä½œ
```python
# æ£€æµ‹åˆ°"åŸåœ°è¸æ­¥"ç»éªŒæ—¶
if exp['st'] == exp['st1']:
    user_prompt += f"  Action {action} â†’ NO PROGRESS (state unchanged)\n"
```

### ğŸš€ é•¿æœŸæ”¹è¿› (ç®—æ³•ä¼˜åŒ–)

1. **å¥–åŠ±å»ºæ¨¡**: åœ¨ç»éªŒä¸­å­˜å‚¨total_rewardï¼Œä¼˜å…ˆé€‰æ‹©é«˜å¥–åŠ±è·¯å¾„
2. **Valueè¿­ä»£**: ä¸ºæ¯ä¸ªçŠ¶æ€è®¡ç®—ä»·å€¼å‡½æ•°ï¼ŒæŒ‡å¯¼åŠ¨ä½œé€‰æ‹©
3. **ç­–ç•¥å­¦ä¹ **: ä»å¤šæ¬¡æ¢ç´¢ä¸­æå–æœ€ä¼˜ç­–ç•¥
4. **ç‰©ç†ç†è§£**: æ•™LLMç†è§£"åå‘æ¨è½¦"æ¥å¹³è¡¡poleçš„ç‰©ç†åŸç†

---

## æµ‹è¯•ç»“è®º

### âœ… æˆåŠŸéªŒè¯
1. **ç¯å¢ƒé›†æˆ**: CartPoleæˆåŠŸé›†æˆåˆ°global_verifieræ¡†æ¶
2. **çŠ¶æ€ç¦»æ•£åŒ–**: è¿ç»­çŠ¶æ€æœ‰æ•ˆè½¬æ¢ä¸ºLLMå¯ç†è§£çš„ç¦»æ•£è¡¨ç¤º
3. **ç»éªŒç³»ç»Ÿ**: ç»éªŒä¿å­˜ã€æ£€ç´¢æœºåˆ¶æ­£å¸¸å·¥ä½œ
4. **æ’ä»¶æ¶æ„**: å®Œå…¨éµå¾ªWebshop/FrozenLakeçš„è®¾è®¡æ¨¡å¼

### âŒ å‘ç°çš„å±€é™
1. **æ€§èƒ½ä¸è¶³**: 18æ­¥è¿œä½äºäººç±»/RLç®—æ³•ï¼ˆé€šå¸¸>100æ­¥ï¼‰
2. **å¾ªç¯é™·é˜±**: LLMå®¹æ˜“é™·å…¥é‡å¤åŠ¨ä½œå¾ªç¯
3. **ç¼ºå°‘å‰ç»**: æœªè€ƒè™‘åŠ¨ä½œçš„é•¿æœŸåæœ

### ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. âœ… **ç«‹å³**: æ›´æ–°promptï¼Œæ·»åŠ å¤±è´¥è­¦å‘Šå’Œå¾ªç¯æ£€æµ‹
2. ğŸ“Š **æœ¬å‘¨**: è¿è¡Œå¤šæ¬¡æµ‹è¯•ï¼Œæ”¶é›†æ›´å¤šå¤±è´¥ç»éªŒ
3. ğŸ§  **ä¸‹å‘¨**: å®ç°åŸºäºå¥–åŠ±çš„ç»éªŒæ’åºå’Œç­–ç•¥æå–

---

## é™„å½•ï¼šä¿å­˜çš„ç»éªŒç¤ºä¾‹

### æˆåŠŸç»éªŒï¼ˆçŠ¶æ€å˜åŒ–ï¼‰
```json
{
  "id": "11-26_13:03:18.874348_cartpole_0-1-1-1-1-1-0",
  "st": {"x_bin": 4, "theta_bin": 3, "x_dot_sign": 1, "theta_dot_sign": -1},
  "action": 0,
  "st1": {"x_bin": 4, "theta_bin": 2, "x_dot_sign": 1, "theta_dot_sign": -1}
}
// âœ… poleä»theta_bin=3ç§»åˆ°2ï¼ŒåŠ¨ä½œæœ‰æ•ˆ
```

### å¤±è´¥ç»éªŒï¼ˆå¯¼è‡´å€’ä¸‹ï¼‰
```json
{
  "id": "11-26_13:03:26.935122_cartpole_0-1-1-1-1-1-0-0-0-0-1-0-1-1-1-1-1-1",
  "st": {"x_bin": 4, "theta_bin": 1, "x_dot_sign": 1, "theta_dot_sign": -1},
  "action": 1,
  "st1": {"x_bin": 4, "theta_bin": 0, "x_dot_sign": 1, "theta_dot_sign": -1}
}
// âŒ theta_binä»1å˜åˆ°0ï¼ˆFAR LEFT falling!ï¼‰ï¼Œåº”é¿å…ï¼
```

### å¾ªç¯ç»éªŒï¼ˆåŸåœ°è¸æ­¥ï¼‰
```json
{
  "id": "11-26_13:03:19.523331_cartpole_0-1-1-1-1-1-0-0",
  "st": {"x_bin": 4, "theta_bin": 2, "x_dot_sign": 1, "theta_dot_sign": -1},
  "action": 0,
  "st1": {"x_bin": 4, "theta_bin": 2, "x_dot_sign": 1, "theta_dot_sign": -1}
}
// âš ï¸ st == st1ï¼ŒåŠ¨ä½œæ— è¿›å±•
```

---

**ç”Ÿæˆæ—¶é—´**: 2025-11-26  
**æµ‹è¯•äººå‘˜**: Global Verifier System  
**ç¯å¢ƒç‰ˆæœ¬**: CartPole-v1 (Gymnasium)

